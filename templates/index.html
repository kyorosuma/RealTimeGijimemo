<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŒ²éŸ³ã¨æ–‡å­—èµ·ã“ã—</title>
    <style>
        #recording-indicator, #transcribing-indicator, #complete-indicator {
            display: none;
            font-weight: bold;
            color: red;
        }
    </style>
</head>
<body>
    <h1>éŒ²éŸ³ã¨æ–‡å­—èµ·ã“ã—</h1>
    <button id="start-btn">éŒ²éŸ³é–‹å§‹</button>
    <button id="stop-btn">éŒ²éŸ³åœæ­¢</button>
    <button id="clear-btn">ã‚¯ãƒªã‚¢</button>

    <h2>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h2>
    <div id="recording-indicator">ğŸ”´ éŒ²éŸ³ä¸­...</div>
    <div id="transcribing-indicator">â³ æ–‡å­—ç”Ÿæˆä¸­...</div>
    <div id="complete-indicator">âœ… å®Œäº†</div>

    <h2>æ–‡å­—èµ·ã“ã—çµæœ</h2>
    <textarea id="transcriptions" rows="10" cols="50" readonly></textarea>

    <script>
        let isRecording = false;
        let isTranscribing = false;

        document.getElementById('start-btn').onclick = function() {
            fetch('/start', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'started') {
                        alert('éŒ²éŸ³ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸ');
                        isRecording = true;
                        isTranscribing = true;
                        updateStatusIndicators();
                        startTranscriptionStream();
                    }
                });
        };

        document.getElementById('stop-btn').onclick = function() {
            fetch('/stop', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'stopped') {
                        alert('éŒ²éŸ³ãŒåœæ­¢ã•ã‚Œã¾ã—ãŸ');
                        isRecording = false;
                        updateStatusIndicators();
                    }
                });
        };

        document.getElementById('clear-btn').onclick = function() {
            document.getElementById('transcriptions').value = "";
        };

        function updateStatusIndicators() {
            document.getElementById('recording-indicator').style.display = isRecording ? 'block' : 'none';
            document.getElementById('transcribing-indicator').style.display = isTranscribing ? 'block' : 'none';
            document.getElementById('complete-indicator').style.display = (!isRecording && !isTranscribing) ? 'block' : 'none';
        }

        function startTranscriptionStream() {
            const source = new EventSource('/transcriptions');
            source.onmessage = function(event) {
                document.getElementById('transcriptions').value += event.data + "\n";
            };
            source.onerror = function() {
                source.close();
            };
            source.addEventListener('end', function() {
                isTranscribing = false;
                updateStatusIndicators();
                source.close();
            });
        }
    </script>
</body>
</html>
